<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Wed Apr 15 17:39:10 2015 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>_p</title>
<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {
    background: #FFFFFF;
    color: #000000;
    font-size: .9em;
}
pre {
    color: #000000;
    width: 79em;
    background: #EEEFEE;
    font-family: courier;
    white-space: pre-wrap;       /* CSS 3 */
    white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
    white-space: -pre-wrap;      /* Opera 4-6 */
    white-space: -o-pre-wrap;    /* Opera 7 */
    word-wrap: break-word;       /* Internet Explorer 5.5+ */
}

pre.new {
      background-color: #e9e9e9;
      border-radius: 15px;
      border: 2px solid #a1a1a1;
      padding: 2em;
    }

pre.old {
      background: #EEEEFF;
      border: double #999999;
    }

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
</head>
<body>
<a name="-top-"></a>
<h1>_p</h1>
<!-- contents of filename: _p -->
<pre class="old">
#!/usr/bin/env perl

<span class="c"># purpose: clpm: Command Line Project Manager (see: p, f, fa, x, xa, z, zdir)</span>

<span class="c">#------------------------------------------------------------------------------</span>
<span class="c">#    Copyright (C) 2014, 2015 David M. Bradford</span>
<span class="c">#</span>
<span class="c">#    This program is free software: you can redistribute it and/or modify</span>
<span class="c">#    it under the terms of the GNU General Public License as published by</span>
<span class="c">#    the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">#    (at your option) any later version.</span>
<span class="c">#</span>
<span class="c">#    This program is distributed in the hope that it will be useful,</span>
<span class="c">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">#    GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c">#    You should have received a copy of the GNU General Public License</span>
<span class="c">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">#------------------------------------------------------------------------------</span>

<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">warnings</span> <span class="w">FATAL</span> <span class="cm">=&gt;</span> <span class="q">&#39;all&#39;</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Cwd</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Data::Dumper</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">File::Basename</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Hash::Util</span> <span class="q">qw(lock_keys)</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">IO::File</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Storable</span> <span class="q">qw(dclone)</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$g</span><span class="sc">;</span>

<span class="k">our</span> <span class="i">$VERSION</span> = <span class="q">&#39;2.0.0&#39;</span><span class="sc">;</span>
<span class="k">our</span> <span class="i">$VAR1</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$max_prev_projects</span> = <span class="n">50</span><span class="sc">;</span>

<span class="k">exit</span> <span class="i">main</span><span class="s">(</span> <span class="i">$0</span><span class="cm">,</span> <span class="i">@ARGV</span> <span class="s">)</span><span class="sc">;</span>

<a name="set_current_project-"></a><span class="k">sub </span><span class="m">set_current_project</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$to</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@</span>{<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">previous</span>}}<span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">current</span>}<span class="sc">;</span>
    <span class="k">while</span> <span class="s">(</span> <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">previous</span>}} &gt; <span class="i">$max_prev_projects</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">shift</span> <span class="i">@</span>{<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">previous</span>}}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">current</span>} = <span class="i">$to</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>
</pre>BREAK<pre class="new">

<a name="unset_current_project-"></a><span class="k">sub </span><span class="m">unset_current_project</span> <span class="s">{</span>
    <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">current</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="is_valid_project-"></a><span class="k">sub </span><span class="m">is_valid_project</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$project</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{<span class="i">$project</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="go_previous_project-"></a><span class="k">sub </span><span class="m">go_previous_project</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$prev</span> = <span class="k">pop</span> <span class="i">@</span>{<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">previous</span>}}<span class="sc">;</span>
    <span class="k">while</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$prev</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">is_valid_project</span><span class="s">(</span><span class="i">$prev</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">set_current_project</span><span class="s">(</span><span class="i">$prev</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">return</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$prev</span> = <span class="k">pop</span> <span class="i">@</span>{<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">previous</span>}}<span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">for</span> <span class="k">my</span> <span class="i">$project</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}}<span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">is_valid_project</span><span class="s">(</span><span class="i">$project</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">set_current_project</span><span class="s">(</span><span class="i">$project</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">return</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="i">unset_current_project</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="pfreeze-"></a><span class="k">sub </span><span class="m">pfreeze</span> <span class="s">{</span>
    <span class="i">envwrite</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">dump_write</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="dump_read-"></a><span class="k">sub </span><span class="m">dump_read</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$ifh</span> = <span class="w">IO::File</span><span class="w">-&gt;new</span><span class="s">(</span><span class="i">$g</span>-&gt;{<span class="w">infile</span>}<span class="cm">,</span> <span class="q">&#39;&lt;&#39;</span><span class="s">)</span><span class="sc">;</span>
    <span class="w">croak</span> <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ifh</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$contents</span> = <span class="k">do</span> <span class="s">{</span> <span class="k">local</span> <span class="i">$/</span><span class="sc">;</span> <span class="q">&lt;$ifh&gt;</span> <span class="s">}</span><span class="sc">;</span>
    <span class="i">$ifh</span><span class="i">-&gt;close</span><span class="sc">;</span>

    <span class="i">$g</span>-&gt;{<span class="w">data</span>} = <span class="k">eval</span> <span class="i">$contents</span><span class="sc">;</span> <span class="c">## no critic</span>
    <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$g</span>-&gt;{<span class="w">data</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="w">croak</span> <span class="q">&quot;failed eval of dump&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="dump_write-"></a><span class="k">sub </span><span class="m">dump_write</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$ofh</span> = <span class="w">IO::File</span><span class="w">-&gt;new</span><span class="s">(</span><span class="i">$g</span>-&gt;{<span class="w">infile</span>}<span class="cm">,</span> <span class="q">&#39;&gt;&#39;</span><span class="s">)</span><span class="sc">;</span>
    <span class="w">croak</span> <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ofh</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">print</span> <span class="i">$ofh</span> <span class="i">Dumper</span><span class="s">(</span><span class="i">$g</span>-&gt;{<span class="w">data</span>}<span class="s">)</span><span class="sc">;</span>
    <span class="i">$ofh</span><span class="i">-&gt;close</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="envwrite-"></a><span class="k">sub </span><span class="m">envwrite</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$ofh</span> = <span class="w">IO::File</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="q">&quot;$ENV{HOME}/.penv&quot;</span><span class="cm">,</span> <span class="q">&#39;&gt;&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="w">croak</span> <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$ofh</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@all</span><span class="sc">;</span>
    <span class="k">for</span> <span class="s">(</span> <span class="q">&quot;a&quot;</span> .. <span class="q">&quot;z&quot;</span><span class="cm">,</span> <span class="q">&quot;A&quot;</span> .. <span class="q">&quot;Z&quot;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$file</span> = <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$_</span>}<span class="sc">;</span>
        <span class="i">$file</span> //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">$ofh</span> <span class="q">&quot;export $_=$file\n&quot;</span><span class="sc">;</span>
        <span class="k">push</span> <span class="i">@all</span><span class="cm">,</span> <span class="i">$file</span> <span class="k">if</span> <span class="i">$file</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">print</span> <span class="i">$ofh</span> <span class="q">qq{export all=&quot;}</span> . <span class="k">join</span><span class="s">(</span><span class="q">&#39; &#39;</span><span class="cm">,</span><span class="i">@all</span><span class="s">)</span> . <span class="q">qq{&quot;\n}</span><span class="sc">;</span>

    <span class="i">$ofh</span><span class="i">-&gt;close</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="fix-"></a><span class="k">sub </span><span class="m">fix</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$n</span><span class="cm">,</span><span class="i">$i</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$spaces</span> = <span class="q">&#39; &#39;</span> x <span class="i">$n</span><span class="sc">;</span>
    <span class="k">for</span> <span class="s">(</span><span class="i">$i</span><span class="s">)</span> <span class="s">{</span>
        <span class="q">s/\n$//m</span><span class="sc">;</span>
        <span class="q">s/^$spaces//mg</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$i</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># structure of data</span>
<span class="c">#################################################################</span>
<span class="c">#$VAR1 = { &#39;current&#39; =&gt; &#39;t&#39;,</span>
<span class="c">#          &#39;projects&#39; =&gt; { &#39;pa&#39; =&gt; { &#39;files&#39; =&gt; { &#39;a&#39; =&gt; &#39;/home/dbradford/t3s/api_test.pl&#39;,</span>
<span class="c">#                                                 &#39;o&#39; =&gt; &#39;/home/dbradford/bin/onetime&#39;,</span>
<span class="c">#                                                 &#39;U&#39; =&gt; &#39;/opt/manfred/lib/Manfred/SimmCreate.pm&#39; },</span>
<span class="c">#                                    &#39;commands&#39; =&gt; { &#39;a&#39; =&gt; { &#39;cmd&#39; =&gt; &#39;/home/dbradford/t3s/api_test.sh&#39;,</span>
<span class="c">#                                                             &#39;label&#39; =&gt; &#39;&#39; },</span>
<span class="c">#                                                    &#39;t&#39; =&gt; { &#39;cmd&#39; =&gt; &#39;./api_post.sh&#39;,</span>
<span class="c">#                                                             &#39;label&#39; =&gt; &#39;&#39; } },</span>
<span class="c">#                                    &#39;label&#39; =&gt; &#39;Manfred Test Gauntlet (TM)&#39;</span>
<span class="c">#                                  },</span>
<span class="c">#                          &#39;pad&#39; =&gt; {etc},</span>
<span class="c">#                        }</span>
<span class="c">#        };</span>

<a name="init-"></a><span class="k">sub </span><span class="m">init</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$current</span> = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">current</span>}<span class="sc">;</span>
    <span class="i">$g</span>-&gt;{<span class="w">current</span>} = <span class="i">$current</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$current</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> !<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">files</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">files</span>} = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span> !<span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">commands</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">commands</span>} = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$g</span>-&gt;{<span class="w">files</span>} = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">files</span>}<span class="sc">;</span>
        <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}  = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">commands</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="del-"></a><span class="k">sub </span><span class="m">del</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$ar</span><span class="cm">,</span> <span class="i">$dr</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">for</span> <span class="s">(</span> <span class="i">@</span>{<span class="i">$ar</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">delete</span> <span class="i">$dr</span>-&gt;{<span class="i">$_</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="fullpath-"></a><span class="k">sub </span><span class="m">fullpath</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">@files</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$pwd</span>   = <span class="i">cwd</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$nwd</span><span class="sc">;</span>
    <span class="k">for</span> <span class="s">(</span><span class="i">@files</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span><span class="q">m!(.*)/(.*)!</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">chdir</span> <span class="i">$1</span> <span class="k">or</span> <span class="k">next</span><span class="sc">;</span>
            <span class="i">$nwd</span> = <span class="i">cwd</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$_</span>   = <span class="q">&quot;$nwd/$2&quot;</span><span class="sc">;</span>
            <span class="k">chdir</span> <span class="i">$pwd</span> <span class="k">or</span> <span class="w">croak</span> <span class="q">&quot;Couldn&#39;t change dir back to $pwd.&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$_</span> = <span class="q">&quot;$pwd/$_&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">chdir</span> <span class="i">$pwd</span> <span class="k">or</span> <span class="w">croak</span> <span class="q">&quot;Couldn&#39;t change dir back to $pwd.&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">@files</span><span class="sc">;</span>
<span class="s">}</span>

<a name="derange-"></a><span class="k">sub </span><span class="m">derange</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$pattern</span><span class="cm">,</span> <span class="i">$hashref</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">return</span> <span class="k">if</span> !<span class="k">defined</span> <span class="i">$pattern</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$pattern</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$pattern</span> !~ <span class="q">/-/</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$pattern</span> =~ <span class="q">s/(.)-(.)/&amp;{</span>
        <span class="q">        sub {</span>
            <span class="q">            my @b = @_;</span>
            <span class="q">            my $a;</span>
            <span class="q">            for ( $b[0]..$b[1] ) {</span>
                <span class="q">                $a .= $_ if $hashref-&gt;{$_};</span>
            <span class="q">            }</span>
            <span class="q">            return $a</span>
        <span class="q">        }</span>
    <span class="q">    }($1,$2)/eg</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$pattern</span><span class="sc">;</span>
<span class="s">}</span>

<a name="pcopy-"></a><span class="k">sub </span><span class="m">pcopy</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$delete_flag</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$from</span><span class="cm">,</span> <span class="i">$to</span> <span class="s">)</span> = <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">args</span>} }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$projects</span> = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}<span class="sc">;</span>

    <span class="i">$projects</span>-&gt;{<span class="i">$to</span>} = <span class="i">dclone</span><span class="s">(</span> <span class="i">$projects</span>-&gt;{<span class="i">$from</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$delete_flag</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">delete</span> <span class="i">$projects</span>-&gt;{<span class="i">$from</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">set_current_project</span><span class="s">(</span><span class="i">$to</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">init</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">list_files</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="zdir-"></a><span class="k">sub </span><span class="m">zdir</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$key</span> = <span class="i">$g</span>-&gt;{<span class="w">args</span>}-&gt;[<span class="n">0</span>]<span class="sc">;</span>

    <span class="k">return</span> <span class="k">if</span> <span class="s">(</span> !<span class="i">$key</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$file</span> = <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$key</span>}<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$file</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="i">STDERR</span> <span class="i">fix</span><span class="s">(</span><span class="n">8</span><span class="cm">,</span><span class="h">&lt;&lt;&quot;        EOF&quot;</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
<span class="hh">        Can&#39;t make sense of $key</span>
<span class="hh">        It is a file you don&#39;t have read permission on,</span>
<span class="hh">        or labels that don&#39;t have associated files.</span>
<span class="h">        EOF</span>
        <span class="k">return</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">print</span> <span class="i">dirname</span><span class="s">(</span><span class="i">$file</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="list_projects-"></a><span class="k">sub </span><span class="m">list_projects</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$projects</span> = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}<span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot;Projects:\n&quot;</span><span class="sc">;</span>
    <span class="k">for</span> <span class="s">(</span> <span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$projects</span> } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$asterisk</span> = <span class="s">(</span> <span class="i">$_</span> <span class="k">eq</span> <span class="i">$g</span>-&gt;{<span class="w">current</span>} <span class="s">)</span> ? <span class="q">&#39;*&#39;</span> <span class="co">:</span> <span class="q">&#39; &#39;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$label</span> = <span class="i">$projects</span>-&gt;{<span class="i">$_</span>}-&gt;{<span class="w">label</span>}<span class="sc">;</span>
        <span class="i">$label</span> //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
        <span class="k">printf</span> <span class="q">&quot;$asterisk %-10s %-15s\n&quot;</span><span class="cm">,</span> <span class="i">$_</span><span class="cm">,</span> <span class="i">$label</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="search-"></a><span class="k">sub </span><span class="m">search</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$arg</span> = <span class="i">$g</span>-&gt;{<span class="w">args</span>}-&gt;[<span class="n">0</span>]<span class="sc">;</span>
    <span class="i">$arg</span> //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$projects</span> = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$output</span> = <span class="q">&quot;Projects:\n&quot;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@found</span><span class="sc">;</span>
    <span class="j">OUTER:</span>
    <span class="k">for</span> <span class="s">(</span> <span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$projects</span> } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$asterisk</span> = <span class="s">(</span> <span class="i">$_</span> <span class="k">eq</span> <span class="i">$g</span>-&gt;{<span class="w">current</span>} <span class="s">)</span> ? <span class="q">&#39;*&#39;</span> <span class="co">:</span> <span class="q">&#39; &#39;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$label</span> = <span class="i">$projects</span>-&gt;{<span class="i">$_</span>}-&gt;{<span class="w">label</span>}<span class="sc">;</span>
        <span class="i">$label</span> //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$project_text</span> = <span class="q">&quot;$_, $label&quot;</span><span class="sc">;</span>
        <span class="k">for</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$g</span>-&gt;{<span class="w">args</span>}}<span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$project_text</span> !~ <span class="q">/$_/i</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">next</span> <span class="j">OUTER</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="i">$output</span> .= <span class="k">sprintf</span> <span class="q">&quot;$asterisk %-10s %-15s\n&quot;</span><span class="cm">,</span> <span class="i">$_</span><span class="cm">,</span> <span class="i">$label</span><span class="sc">;</span>
        <span class="k">push</span> <span class="i">@found</span><span class="cm">,</span> <span class="i">$_</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">@found</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">set_current_project</span><span class="s">(</span><span class="i">$found</span>[<span class="n">0</span>]<span class="s">)</span><span class="sc">;</span>
        <span class="i">init</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">list_files</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">print</span> <span class="i">$output</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="func_p-"></a><span class="k">sub </span><span class="m">func_p</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$arg</span> = <span class="i">$g</span>-&gt;{<span class="w">args</span>}-&gt;[<span class="n">0</span>]<span class="sc">;</span>
    <span class="i">$arg</span> //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$projects</span> = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$cmd</span><span class="cm">,</span> <span class="i">$proj</span> <span class="s">)</span> = <span class="s">(</span> <span class="i">$arg</span> =~ <span class="q">/(.)(.*)/</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$cmd</span> &amp;&amp; <span class="i">$cmd</span> <span class="k">eq</span> <span class="q">&#39;?&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$g</span>-&gt;{<span class="w">args</span>}-&gt;[<span class="n">0</span>] =~ <span class="q">s/^.//</span><span class="sc">;</span>
        <span class="i">search</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$cmd</span> &amp;&amp; <span class="i">$cmd</span> <span class="k">eq</span> <span class="q">&#39;-&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">delete</span> <span class="i">$projects</span>-&gt;{<span class="i">$proj</span>}<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$proj</span> <span class="k">eq</span> <span class="i">$g</span>-&gt;{<span class="w">current</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">go_previous_project</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> !<span class="i">$arg</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">list_projects</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">set_current_project</span><span class="s">(</span><span class="i">$arg</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$projects</span>-&gt;{<span class="i">$arg</span>}-&gt;{<span class="w">label</span>} = <span class="i">$g</span>-&gt;{<span class="w">args</span>}-&gt;[<span class="n">1</span>]
          <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">args</span>}-&gt;[<span class="n">1</span>] <span class="s">)</span><span class="sc">;</span>
        <span class="i">init</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">list_files</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="list_files-"></a><span class="k">sub </span><span class="m">list_files</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">@args</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">@args</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Bad arguments.\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">my</span> <span class="i">$label</span> = <span class="i">$g</span>-&gt;{<span class="w">data</span>}-&gt;{<span class="w">projects</span>}-&gt;{ <span class="i">$g</span>-&gt;{<span class="w">current</span>} }-&gt;{<span class="w">label</span>}<span class="sc">;</span>
    <span class="i">$label</span> //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot;Project: $g-&gt;{current} ($label)\n&quot;</span><span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot;Current files:\n&quot;</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">%sorted</span><span class="sc">;</span>
    <span class="k">for</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$g</span>-&gt;{<span class="w">files</span>} } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span> <span class="s">)</span> = <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$_</span>} =~ <span class="q">m!(.*)/(.*)!</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$i</span> = <span class="k">lc</span><span class="s">(</span><span class="i">$b</span><span class="s">)</span> . <span class="k">lc</span><span class="s">(</span><span class="i">$a</span><span class="s">)</span><span class="sc">;</span>
        <span class="s">(</span> <span class="i">$sorted</span>{<span class="i">$i</span>}-&gt;{<span class="w">path</span>} <span class="s">)</span> = <span class="s">(</span> <span class="i">$a</span> =~ <span class="q">/(.{1,70})/</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">(</span> <span class="i">$sorted</span>{<span class="i">$i</span>}-&gt;{<span class="w">file</span>} <span class="s">)</span> = <span class="s">(</span> <span class="i">$b</span> =~ <span class="q">/(.{1,50})/</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$sorted</span>{<span class="i">$i</span>}-&gt;{<span class="w">let</span>} = <span class="i">$_</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">for</span> <span class="s">(</span> <span class="k">sort</span> <span class="k">keys</span> <span class="i">%sorted</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">printf</span> <span class="q">&quot;%-1s %-50s %-70s\n&quot;</span><span class="cm">,</span> <span class="i">$sorted</span>{<span class="i">$_</span>}-&gt;{<span class="w">let</span>}<span class="cm">,</span>
            <span class="i">$sorted</span>{<span class="i">$_</span>}-&gt;{<span class="w">file</span>}<span class="cm">,</span> <span class="i">$sorted</span>{<span class="i">$_</span>}-&gt;{<span class="w">path</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="func_f-"></a><span class="k">sub </span><span class="m">func_f</span> <span class="s">{</span>
    <span class="k">if</span> <span class="s">(</span> !<span class="i">$g</span>-&gt;{<span class="w">current</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="q">&quot;Must set current project first.\n&quot;</span><span class="sc">;</span>
        <span class="k">return</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$na</span>  = <span class="k">scalar</span> <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">args</span>} }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">@x</span>   = <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">args</span>} }<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$na</span> == <span class="n">1</span> <span class="k">or</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;fa&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$f</span>  = <span class="q">&#39;&#39;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$f1</span> = <span class="n">0</span><span class="sc">;</span>

        <span class="k">my</span> <span class="i">$tmp</span> = <span class="i">derange</span><span class="s">(</span> <span class="i">$x</span>[<span class="n">0</span>]<span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">@l</span> = <span class="k">split</span> <span class="q">//</span><span class="cm">,</span> <span class="s">(</span> <span class="k">defined</span><span class="s">(</span><span class="i">$tmp</span><span class="s">)</span> ? <span class="i">$tmp</span> <span class="co">:</span> <span class="q">&#39;&#39;</span> <span class="s">)</span><span class="sc">;</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;fa&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">@l</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$g</span>-&gt;{<span class="w">files</span>} } <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$l</span>[<span class="n">0</span>] <span class="k">eq</span> <span class="q">&#39;-&#39;</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Delete labels</span>
            <span class="k">shift</span> <span class="i">@l</span><span class="sc">;</span>
            <span class="i">del</span><span class="s">(</span> \<span class="i">@l</span><span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>                   <span class="c"># Edit files</span>
            <span class="k">for</span> <span class="s">(</span><span class="i">@l</span><span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$_</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$f</span> .= <span class="q">&quot;$g-&gt;{files}-&gt;{$_} &quot;</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span> ++<span class="i">$f1</span> <span class="s">}</span>
            <span class="s">}</span>
            <span class="k">if</span> <span class="s">(</span> !<span class="i">$f1</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">exec</span> <span class="q">&quot;$ENV{EDITOR} $f&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Can&#39;t make sense of $x[0].\n&quot;</span><span class="sc">;</span>
                <span class="k">print</span> <span class="i">STDERR</span>
                  <span class="q">&quot;It is a file you don&#39;t have read permission on, \n&quot;</span><span class="sc">;</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;or labels that don&#39;t have associated files.\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$na</span> == <span class="n">2</span> <span class="k">and</span> <span class="i">$x</span>[<span class="n">0</span>] <span class="k">ne</span> <span class="q">&#39;,&#39;</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Add file to specific label</span>
        <span class="k">my</span> <span class="s">(</span><span class="i">$file</span><span class="s">)</span> = <span class="i">fullpath</span><span class="s">(</span> <span class="i">$x</span>[<span class="n">1</span>] <span class="s">)</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">h_ident</span>}-&gt;{ <span class="i">$x</span>[<span class="n">0</span>] } <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="k">-r</span> <span class="i">$file</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{ <span class="i">$x</span>[<span class="n">0</span>] } = <span class="i">$file</span><span class="sc">;</span>
                <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Can&#39;t read: $file\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Invalid identifier: $x[0]\n&quot;</span><span class="sc">;</span>
            <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&#39;Use one of: &#39;</span> . <span class="k">join</span><span class="s">(</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">a_ident</span>} } <span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$x</span>[<span class="n">0</span>] &amp;&amp; <span class="i">$x</span>[<span class="n">0</span>] <span class="k">eq</span> <span class="q">&#39;,&#39;</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Add files to generic label</span>
        <span class="k">shift</span> <span class="i">@x</span><span class="sc">;</span>
        <span class="k">for</span> <span class="s">(</span><span class="i">@x</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="s">(</span><span class="i">$file</span><span class="s">)</span> = <span class="i">fullpath</span><span class="s">(</span><span class="i">$_</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="k">-r</span> <span class="i">$file</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">for</span> <span class="k">my</span> <span class="i">$i</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">a_ident</span>} } <span class="s">)</span> <span class="s">{</span>
                    <span class="k">if</span> <span class="s">(</span> !<span class="k">exists</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$i</span>} <span class="s">)</span> <span class="s">{</span>
                        <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$i</span>} = <span class="i">$file</span><span class="sc">;</span>
                        <span class="k">last</span><span class="sc">;</span>
                    <span class="s">}</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Can&#39;t read: $file\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>    <span class="c"># Error/Print list of files</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$na</span> != <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Bad arguments.\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">list_files</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="func_x-"></a><span class="k">sub </span><span class="m">func_x</span> <span class="s">{</span>
    <span class="k">if</span> <span class="s">(</span> !<span class="i">$g</span>-&gt;{<span class="w">current</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="q">&quot;Must set current project first.\n&quot;</span><span class="sc">;</span>
        <span class="k">return</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$na</span>    = <span class="k">scalar</span> <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">args</span>} }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">@a</span>     = <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">args</span>} }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$f1</span>    = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$f2</span>    = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$flist</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$tmp</span> = <span class="i">derange</span><span class="s">(</span> <span class="i">$a</span>[<span class="n">0</span>]<span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">cmds</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@l</span> = <span class="k">split</span> <span class="q">//</span><span class="cm">,</span> <span class="s">(</span> <span class="k">defined</span><span class="s">(</span><span class="i">$tmp</span><span class="s">)</span> ? <span class="i">$tmp</span> <span class="co">:</span> <span class="q">&#39;&#39;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$g_2</span> = <span class="k">defined</span><span class="s">(</span> <span class="i">$l</span>[<span class="n">0</span>] <span class="s">)</span> ? <span class="i">$l</span>[<span class="n">0</span>] <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$g_2</span> <span class="k">eq</span> <span class="q">&#39;.&#39;</span> <span class="k">or</span> <span class="i">$g_2</span> <span class="k">eq</span> <span class="q">&#39;-&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="k">shift</span> <span class="i">@l</span> <span class="s">}</span>

    <span class="k">for</span> <span class="s">(</span><span class="i">@l</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> !<span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$_</span>} <span class="s">)</span> <span class="s">{</span> ++<span class="i">$f1</span> <span class="s">}</span>
    <span class="s">}</span>
    <span class="i">$a</span>[<span class="n">1</span>] //= <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$a</span>[<span class="n">1</span>] =~ <span class="q">/^-(.*)/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$flist</span> = <span class="i">$1</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$na</span> == <span class="n">1</span> <span class="k">or</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;xa&#39;</span> <span class="k">or</span> <span class="i">$flist</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;xa&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">@l</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$g</span>-&gt;{<span class="w">cmds</span>} } <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$g_2</span> <span class="k">eq</span> <span class="q">&#39;-&#39;</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Delete labels</span>
            <span class="i">del</span><span class="s">(</span> \<span class="i">@l</span><span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">cmds</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$g_2</span> <span class="k">eq</span> <span class="q">&#39;.&#39;</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Edit commands</span>
            <span class="k">my</span> <span class="i">$f</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$temp</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> !<span class="i">$f1</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">for</span> <span class="s">(</span><span class="i">@l</span><span class="s">)</span> <span class="s">{</span>
                    <span class="i">$temp</span> = <span class="q">&quot;/tmp/c.$$.$_&quot;</span><span class="sc">;</span>
                    <span class="k">my</span> <span class="i">$ofh</span> = <span class="w">IO::File</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="i">$temp</span><span class="cm">,</span> <span class="q">&#39;&gt;&#39;</span> <span class="s">)</span><span class="sc">;</span>
                    <span class="w">croak</span> <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$ofh</span> <span class="s">)</span><span class="sc">;</span>

                    <span class="k">print</span> <span class="i">$ofh</span>
                      <span class="q">&quot;$g-&gt;{cmds}-&gt;{$_}-&gt;{label}: $g-&gt;{cmds}-&gt;{$_}-&gt;{cmd}\n&quot;</span><span class="sc">;</span>
                    <span class="k">print</span> <span class="i">$ofh</span>
<span class="q">&quot;# The label precedes the colon above and my be edited freely\n&quot;</span><span class="sc">;</span>
                    <span class="k">print</span> <span class="i">$ofh</span> <span class="q">&quot;# As long as the colon is left intact.\n&quot;</span><span class="sc">;</span>
                    <span class="k">print</span> <span class="i">$ofh</span>
<span class="q">&quot;# Only the first line is read. Don&#39;t add more lines to this file.\n&quot;</span><span class="sc">;</span>
                    <span class="i">$f</span> .= <span class="q">&quot;$temp &quot;</span><span class="sc">;</span>

                    <span class="i">$ofh</span><span class="i">-&gt;close</span><span class="sc">;</span>
                <span class="s">}</span>

                <span class="k">system</span><span class="s">(</span><span class="q">&quot;$ENV{EDITOR} $f&quot;</span><span class="s">)</span><span class="sc">;</span>
                <span class="k">for</span> <span class="s">(</span><span class="i">@l</span><span class="s">)</span> <span class="s">{</span>
                    <span class="k">my</span> <span class="i">$m</span><span class="sc">;</span>
                    <span class="i">$temp</span> = <span class="q">&quot;/tmp/c.$$.$_&quot;</span><span class="sc">;</span>
                    <span class="k">my</span> <span class="i">$ifh</span> = <span class="w">IO::File</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="i">$temp</span><span class="cm">,</span> <span class="q">&#39;&lt;&#39;</span> <span class="s">)</span><span class="sc">;</span>
                    <span class="w">croak</span> <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$ifh</span> <span class="s">)</span><span class="sc">;</span>
                    <span class="k">chomp</span><span class="s">(</span> <span class="i">$m</span> = <span class="q">&lt;$ifh&gt;</span> <span class="s">)</span><span class="sc">;</span>
                    <span class="k">if</span> <span class="s">(</span> <span class="i">$m</span> =~ <span class="q">/(.*):\s*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
                        <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$_</span>}-&gt;{<span class="w">label</span>} = <span class="i">$1</span><span class="sc">;</span>
                        <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$_</span>}-&gt;{<span class="w">cmd</span>}   = <span class="i">$2</span><span class="sc">;</span>
                    <span class="s">}</span>
                    <span class="k">else</span> <span class="s">{</span>
                        <span class="k">print</span> <span class="i">STDERR</span>
                          <span class="q">&quot;Bad format on file for command labeled $_\n&quot;</span><span class="sc">;</span>
                    <span class="s">}</span>
                    <span class="i">$ifh</span><span class="i">-&gt;close</span><span class="sc">;</span>
                    <span class="k">unlink</span> <span class="i">$temp</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Bad labels in $a[0].\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>    <span class="c"># Run commands</span>
            <span class="k">my</span> <span class="i">$f</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$flist</span><span class="s">)</span> <span class="s">{</span>

                <span class="k">my</span> <span class="i">@m</span> = <span class="k">split</span> <span class="q">//</span><span class="cm">,</span> <span class="i">derange</span><span class="s">(</span> <span class="i">$flist</span><span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>} <span class="s">)</span><span class="sc">;</span>
                <span class="k">for</span> <span class="s">(</span><span class="i">@m</span><span class="s">)</span> <span class="s">{</span>
                    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$_</span>} <span class="s">)</span> <span class="s">{</span>
                        <span class="i">$f</span> .= <span class="q">&quot;$g-&gt;{files}-&gt;{$_} &quot;</span><span class="sc">;</span>
                    <span class="s">}</span>
                    <span class="k">else</span> <span class="s">{</span> ++<span class="i">$f2</span> <span class="s">}</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$f2</span><span class="s">)</span> <span class="s">{</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Can&#39;t make sense of $flist.\n&quot;</span><span class="sc">;</span>
                <span class="k">print</span> <span class="i">STDERR</span>
                  <span class="q">&quot;It is a file you don&#39;t have read permission on, \n&quot;</span><span class="sc">;</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;or labels that don&#39;t have associated files.\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">elsif</span> <span class="s">(</span> !<span class="i">$f1</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">for</span> <span class="s">(</span><span class="i">@l</span><span class="s">)</span> <span class="s">{</span>
                    <span class="k">print</span> <span class="q">&quot;$g-&gt;{cmds}-&gt;{$_}-&gt;{cmd} $f\n&quot;</span><span class="sc">;</span>
                    <span class="k">if</span> <span class="s">(</span> <span class="k">system</span><span class="s">(</span><span class="q">&quot;/bin/sh -c &#39;$g-&gt;{cmds}-&gt;{$_}-&gt;{cmd} $f&#39;&quot;</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                        <span class="k">print</span> <span class="i">STDERR</span>
<span class="q">&quot;An error occurred while running: $g-&gt;{cmds}-&gt;{$_}-&gt;{cmd}\n&quot;</span><span class="sc">;</span>
                        <span class="k">last</span><span class="sc">;</span>
                    <span class="s">}</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Bad labels in $a[0].\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$na</span> == <span class="n">2</span> <span class="k">or</span> <span class="i">$na</span> == <span class="n">3</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">h_ident</span>}-&gt;{ <span class="i">$a</span>[<span class="n">0</span>] } <span class="s">)</span> <span class="s">{</span>    <span class="c"># Add command to specific label</span>
            <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{ <span class="i">$a</span>[<span class="n">0</span>] }-&gt;{<span class="w">cmd</span>} = <span class="i">$a</span>[<span class="n">1</span>]<span class="sc">;</span>
            <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{ <span class="i">$a</span>[<span class="n">0</span>] }-&gt;{<span class="w">label</span>} = <span class="i">$a</span>[<span class="n">2</span>] || <span class="q">&#39;&#39;</span><span class="sc">;</span>
            <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$a</span>[<span class="n">0</span>] <span class="k">eq</span> <span class="q">&#39;,&#39;</span> <span class="s">)</span> <span class="s">{</span>             <span class="c"># Add command to generic label</span>
            <span class="k">for</span> <span class="k">my</span> <span class="i">$i</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">a_ident</span>} } <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> !<span class="k">exists</span> <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">cmd</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">cmd</span>} = <span class="i">$a</span>[<span class="n">1</span>]<span class="sc">;</span>
                    <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">label</span>} = <span class="i">$a</span>[<span class="n">2</span>] || <span class="q">&#39;&#39;</span><span class="sc">;</span>
                    <span class="k">last</span><span class="sc">;</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="i">pfreeze</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>                               <span class="c"># Error</span>
            <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Invalid identifier: $a[0]\n&quot;</span><span class="sc">;</span>
            <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&#39;Use one of: &#39;</span> . <span class="k">join</span><span class="s">(</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$g</span>-&gt;{<span class="w">a_ident</span>} } <span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>                                   <span class="c"># Print list of commands</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$na</span> != <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">print</span> <span class="i">STDERR</span> <span class="q">&quot;Bad arguments.\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">print</span> <span class="q">&quot;Project: $g-&gt;{current}\n&quot;</span><span class="sc">;</span>
        <span class="k">print</span> <span class="q">&quot;Current commands:\n&quot;</span><span class="sc">;</span>
        <span class="k">for</span> <span class="s">(</span>
            <span class="k">sort</span> <span class="s">{</span> <span class="k">lc</span><span class="s">(</span><span class="i">$a</span><span class="s">)</span> <span class="k">cmp</span> <span class="k">lc</span><span class="s">(</span><span class="i">$b</span><span class="s">)</span> || <span class="i">$b</span> <span class="k">cmp</span> <span class="i">$a</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$g</span>-&gt;{<span class="w">cmds</span>} }
          <span class="s">)</span>
        <span class="s">{</span>
            <span class="k">printf</span> <span class="q">&quot;%1s: %-20s %-15s\n&quot;</span><span class="cm">,</span> <span class="i">$_</span><span class="cm">,</span> <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$_</span>}-&gt;{<span class="w">label</span>}<span class="cm">,</span>
              <span class="i">$g</span>-&gt;{<span class="w">cmds</span>}-&gt;{<span class="i">$_</span>}-&gt;{<span class="w">cmd</span>}<span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="func_z-"></a><span class="k">sub </span><span class="m">func_z</span> <span class="s">{</span>
    <span class="k">print</span> <span class="i">fix</span><span class="s">(</span><span class="n">4</span><span class="cm">,</span><span class="h">&lt;&lt;&quot;    EOF&quot;</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
<span class="hh">    Command Line Program Managers (clpm) v$VERSION</span>
<span class="hh">    Help commands:</span>
<span class="hh">                z  - this listing</span>
<span class="hh">    Organization commands:</span>
<span class="hh">                f  - manage files</span>
<span class="hh">                    examples:</span>
<span class="hh">                    show list of files:    \$ f</span>
<span class="hh">                    edit file 1, 3, and L: \$ f 13L</span>
<span class="hh">                    edit all files:        \$ fa</span>
<span class="hh">                    add file to the list : \$ f , /tmp/a.dmb /etc/hosts /etc/passwd</span>
<span class="hh">                    add file with label L: \$ f L /tmp/a.dmb</span>
<span class="hh">                    remove file 1, 3, L  : \$ f -13L</span>
<span class="hh">                x  - manage commands (same basic format as f)</span>
<span class="hh">                    examples:</span>
<span class="hh">                    show list of cmds:     \$ x</span>
<span class="hh">                    run cmd 1, 3, and L:   \$ x 13L</span>
<span class="hh">                    edit cmd 1, 3, and L:  \$ x .13L</span>
<span class="hh">                    edit all cmds:         \$ xa</span>
<span class="hh">                    add cmd to the list :  \$ x , &#39;echo hey&#39; &#39;Optional Label&#39;</span>
<span class="hh">                        NOTE: surround command with quotes</span>
<span class="hh">                    add cmd with label L:  \$ x L &#39;echo howdy; echo there&#39; &#39;Optional Label&#39;</span>
<span class="hh">                    remove cmd 1, 3, L  :  \$ x -13L</span>
<span class="hh">                p  - change project/view list of projects</span>
<span class="hh">                    show project list:     \$ p</span>
<span class="hh">                    switch to project:     \$ p myproj</span>
<span class="hh">                    remove project:        \$ p -myproj</span>
<span class="hh">    Current project: $g-&gt;{data}-&gt;{current}</span>
<span class="h">    EOF</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>


<a name="usage-"></a><span class="k">sub </span><span class="m">usage</span> <span class="s">{</span>
    <span class="k">return</span> <span class="h">&lt;&lt;EOF</span><span class="sc">;</span>
<span class="hh">Usage: note [OPTION]... PATTERN...</span>
<span class="hh">Add or retrieve a note</span>
<span class="hh">Example: note lawnmower</span>

<span class="hh">-l [library], --library=[library] Search a specific library</span>
<span class="hh">-1, --1         use notefile #1</span>
<span class="hh">-2, --2         use notefile #2</span>
<span class="hh">-a, --add       Add a note</span>
<span class="hh">-t, --title     Search title only</span>
<span class="hh">-w, --word      Only find if PATTERN is a word</span>
<span class="hh">-e, --edit      Edit the notes file</span>
<span class="hh">-v, --verbose   Show additional information about entries matched / not matched</span>
<span class="h">EOF</span>
<span class="s">}</span>


<a name="main-"></a><span class="k">sub </span><span class="m">main</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$prog</span><span class="cm">,</span> <span class="i">@args</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="i">$g</span> = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@g_keys</span> = <span class="q">qw(</span>
      <span class="q">a_ident</span>
      <span class="q">args</span>
      <span class="q">cmds</span>
      <span class="q">current</span>
      <span class="q">data</span>
      <span class="q">files</span>
      <span class="q">h_ident</span>
      <span class="q">infile</span>
      <span class="q">prog</span>
    <span class="q">)</span><span class="sc">;</span>

    <span class="i">lock_keys</span><span class="s">(</span> <span class="i">%</span>{<span class="i">$g</span>}<span class="cm">,</span> <span class="i">@g_keys</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$g</span>-&gt;{<span class="w">args</span>}          = \<span class="i">@args</span><span class="sc">;</span>
    <span class="i">$g</span>-&gt;{<span class="w">infile</span>}        = <span class="i">$ENV</span>{<span class="w">PDUMP</span>} || <span class="q">&quot;$ENV{HOME}/.pdump&quot;</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@ident</span> = <span class="s">(</span> <span class="q">&#39;a&#39;</span> .. <span class="q">&#39;z&#39;</span><span class="cm">,</span> <span class="q">&#39;A&#39;</span> .. <span class="q">&#39;Z&#39;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">%ident</span><span class="sc">;</span>

    <span class="i">@ident</span>{<span class="i">@ident</span>} = <span class="s">(</span><span class="n">1</span><span class="s">)</span> x <span class="i">@ident</span><span class="sc">;</span>

    <span class="i">$g</span>-&gt;{<span class="w">a_ident</span>} = \<span class="i">@ident</span><span class="sc">;</span>
    <span class="i">$g</span>-&gt;{<span class="w">h_ident</span>} = \<span class="i">%ident</span><span class="sc">;</span>

    <span class="s">(</span><span class="i">$prog</span><span class="s">)</span> = <span class="s">(</span> <span class="i">$prog</span> =~ <span class="q">m!.*/(.*)!</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>[<span class="n">0</span>] <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$args</span>[<span class="n">0</span>] <span class="k">eq</span> <span class="q">&#39;--help&#39;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$prog</span> = <span class="q">&#39;z&#39;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$prog</span> <span class="k">eq</span> <span class="q">&#39;_p&#39;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$args</span>[<span class="n">0</span>] <span class="k">eq</span> <span class="q">&#39;cp&#39;</span> <span class="k">or</span> <span class="i">$args</span>[<span class="n">0</span>] <span class="k">eq</span> <span class="q">&#39;mv&#39;</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$prog</span> = <span class="k">shift</span> <span class="i">@args</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="i">$g</span>-&gt;{<span class="w">prog</span>} = <span class="i">$prog</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="i">$g</span>-&gt;{<span class="w">infile</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">dump_read</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$g</span>-&gt;{<span class="w">data</span>} = <span class="s">{</span>
            <span class="q">&#39;current&#39;</span>  <span class="cm">=&gt;</span> <span class="q">&#39;&#39;</span><span class="cm">,</span>
            <span class="q">&#39;projects&#39;</span> <span class="cm">=&gt;</span> <span class="s">{</span><span class="s">}</span><span class="cm">,</span>
        <span class="s">}</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">init</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;cp&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">pcopy</span><span class="s">(</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;mv&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$delete_flag</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="i">pcopy</span><span class="s">(</span> <span class="i">$delete_flag</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;zdir&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">zdir</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;_p&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">func_p</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;_f&#39;</span> <span class="k">or</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;fa&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">func_f</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;x&#39;</span> <span class="k">or</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;xa&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">func_x</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$g</span>-&gt;{<span class="w">prog</span>} <span class="k">eq</span> <span class="q">&#39;z&#39;</span> <span class="s">)</span> <span class="s">{</span> <span class="i">func_z</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
<span class="s">}</span>
<a name="EOF-"></a></pre>
</body>
</html>
